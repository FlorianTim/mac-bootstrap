@echo off
setlocal EnableExtensions

REM mac-bootstrap generator (creates a folder named "mac-bootstrap" in the current directory)
REM Requires: Windows PowerShell (built-in on most Windows installs)

set "B64FILE=%TEMP%\mac-bootstrap-gen.b64"
set "PS1FILE=%TEMP%\mac-bootstrap-gen.ps1"

if exist "%CD%\mac-bootstrap" (
  echo ERROR: "%CD%\mac-bootstrap" already exists. Delete/rename it and re-run.
  exit /b 1
)

if exist "%B64FILE%" del /f /q "%B64FILE%" >nul 2>&1
if exist "%PS1FILE%" del /f /q "%PS1FILE%" >nul 2>&1

> "%B64FILE%" (
  echo JABFAHIAcgBvAHIAQQBjAHQAaQBvAG4AUAByAGUAZgBlAHIAZQBuAGMAZQAgAD0AIAAnAFMAdABv
  echo AHAAJwAKACQAcgBvAG8AdAAgAD0AIABKAG8AaQBuAC0AUABhAHQAaAAgACgARwBlAHQALQBMAG8A
  echo YwBhAHQAaQBvAG4AKQAgACcAbQBhAGMALQBiAG8AbwB0AHMAdAByAGEAcAAnAAoAaQBmACAAKABU
  echo AGUAcwB0AC0AUABhAHQAaAAgACQAcgBvAG8AdAApACAAewAgAFcAcgBpAHQAZQAtAEgAbwBzAHQA
  echo IAAiAEYAbwBsAGQAZQByACAAYQBsAHIAZQBhAGQAeQAgAGUAeABpAHMAdABzADoAIAAkAHIAbwBv
  echo AHQAIgA7ACAAZQB4AGkAdAAgADEAIAB9AAoATgBlAHcALQBJAHQAZQBtACAALQBJAHQAZQBtAFQA
  echo eQBwAGUAIABEAGkAcgBlAGMAdABvAHIAeQAgAC0AUABhAHQAaAAgACQAcgBvAG8AdAAgAHwAIABP
  echo AHUAdAAtAE4AdQBsAGwACgAkAGYAaQBsAGUAcwAgAD0AIABAACgAKQAKACQAZgBpAGwAZQBzAFsA
  echo JwBSAEUAQQBEAE0ARQAuAG0AZAAnAF0AIAA9ACAAQAAiACcACgAjACAAbQBhAGMALQBiAG8AbwB0
  echo AHMAdAByAGEAcAAKAAoAQQAgAG0AbwBkAHUAbABhAHIALAAgAEcAaQB0AC0AZgByAGkAZQBuAGQA
  echo bAB5ACAAbQBhAGMATwBTACAAYgBvAG8AdABzAHQAcgBhAHAAIAByAGUAcABvAHMAaQB0AG8AcgB5
  echo ACAAdABoAGEAdAAgAGkAbgBzAHQAYQBsAGwAcwAgAGEAbgBkACAAdQBwAGQAYQB0AGUAcwAgAHMA
  echo bwBmAHQAdwBhAHIAZQAgAHYAaQBhADoACgAKAC0AIAAqACoASABvAG0AZQBiAHIAZQB3ACAAQgB1
  echo AG4AZABsAGUAKgAqACAAKABgAGIAcgBlAHcAIABiAHUAbgBkAGwAZQBgACkAIAB1AHMAaQBuAGcA
  echo IAB0AG8AcABpAGMALQBiAGEAcwBlAGQAIABCAGUAdwBmAGkAbABlAHMACgAtACAAKgAqAG4AcABt
  echo ACAAZwBsAG8AYgBhAGwAIAB0AG8AbwBsAHMAKgAqACAAKABlAC4AZwAuACAAQwBvAHIAZABvAHYA
  echo YQApACAAZgByAG8AbQAgAGEAIABtAGEAbgBpAGYAZQBzAHQAIABmAGkAbABlAAoALQAgACoAKgBW
  echo AFMAIABDAG8AZABlACAAZQB4AHQAZQBuAHMAaQBvAG4AcwAqACoAIABmAHIAbwBtACAAYQAgAG0A
  echo YQBuAGkAZQBzAHQAIABmAGkAbABlAAoACgAjACMAIABRAHUAaQBjAGsAIABzAHQAYQByAHQAIABu
  echo AGUAdwAgAE0AYQBjACkACgAKADEALgAgAEMAbABvAG4AZQAgAC8AIABjAG8AcAB5ACAAdABoAGkA
  echo cwAgAHIAZQBwAG8AcwBpAHQAbwByAHkAIAB0AG8AIAB0AGgAZQAgAE0AYQBjACAAKABlAC4AZwAu
  echo ACAAfgAvAG0AYQBjAC0AYgBvAG8AdABzAHQAcgBhAHAAKQAuAAoAMgAuACAATwBwAGUAbgAgAFQA
  echo ZQByAG0AaQBuAGEAbAAgAGkAbgAgAHQAaABlACAAcgBlAHAAbwAgAGYAbwBsAGQAZQByAC4ACgAz
  echo AC4AIABSAHUAbgA6AAoACgBgAGAAIABiAGEAcwBoAAoAYgBhAHMAaAAgAHMAYwByAGkAcAB0AHMA
  echo LwBpAG4AcwB0AGEAbABsAC0AYQBsAGwALgBzAGgACgBgAGAAYAoACgBJAGYAIAB5AG8AdQAgAHcA
  echo YQBuAHQAIABvAG4AbAB5ACAAdABoAGUAIABlAHYAZQByAHkAZABhAHkAIABzAGUAdAB1AHAAIAAo
  echo AGIAYQBzAGUAIAArACAAbwBmAGYAaQBjAGUAIAArACAAYgByAG8AdwBzAGUAcgBzAC8AbQBlAGQA
  echo aQBhACkAOgAKAAoAYABgAGIAYQBzAGgACgBiAGEAcwBoACAAcwBjAHIAaQBwAHQAcwAvAGkAbgBz
  echo AHQAYQBsAGwALgBzAGgACgBgAGAAYAoACgBJAGYAIAB5AG8AdQAgAHcAYQBuAHQAIABvAG4AbAB5
  echo ACAAdABoAGUAIABkAGUAdgBlAGwAbwBwAGUAcgAgAHMAZQB0AHUAcAA6AAoACgBgAGAAIABiAGEA
  echo cwBoAAoAYgBhAHMAaAAgAHMAYwByAGkAcAB0AHMALwBpAG4AcwB0AGEAbABsAC0AZABlAHYALgBz
  echo AGgACgBgAGAAYAoACgAjACMAIABVAHAAZABhAHQAZQAgAGUAdgBlAHIAeQB0AGgAaQBuAGcACgAK
  echo AGAAYABiAGEAcwBoAAoAYgBhAHMAaAAgAHMAYwByAGkAcAB0AHMALwB1AHAAZABhAHQAZQAuAHMA
  echo AGgACgBgAGAAYAoACgAjACMAIABDAGwAZQBhAG4AdQBwACAAKAByAGUAbQBvAHYAZQAgAGwAZQBm
  echo AHQAbwB2AGUAcgAgAGQAbwB3AG4AbABvAGEAZABzAC8AYwBhAGMAaABlAHMAKQAKAAoAYABgAGIA
  echo YQBzAGgACgBiAGEAcwBoACAAcwBjAHIAaQBwAHQAcwAvAGMAbABlAGEAbgB1AHAALgBzAGgACgBg
  echo AGAAYAoACgAjACMAIABCAGUAdwAgAGQAaQBhAGcAbgBvAHMAdABpAGMAcwAgAC8AIABzAGUAbABm
  echo AC0AaABlAGEAbAAgAGgAZQBsAHAAZQByAHMACgAKAGAAYABiAGEAcwBoAAoAYgBhAHMAaAAgAHMA
  echo YwByAGkAcAB0AHMALwBmAGkAeAAtAGIAcgBlAHcALgBzAGgACgBgAGAAYAoACgAjACMAIABTAHQA
  echo cgB1AGMAdAB1AHIAZQAKAAoALQAgAGAAQgByAGUAdwBmAGkAbABlAHMALwBgIOKAlAAgAHQAbwBw
  echo AGkAYwAtAGIAYQBzAGUAZAAgAEIAcgBlAHcAZgBpAGwAZQBzACAAKABCAHIAZQB3ACAAQgB1AG4A
  echo ZABsAGUAIABtAGEAbgBpAGYAZQBzAHQAcwApAAoALQAgAGAA bQBhAG4AaQBmAGUAcwB0AHMALwBu
  echo AHAAbQAtAGcAbABvAGIAYQBsAC4AdAB4AHQAIABgIOKAlAAgAG4AcABtACAAZwBsAG8AYgBhAGwA
  echo IABwAGEAYwBrAGEAZwBlAHMAIAAoAG8AbgBlACAAcABlAHIAIABsAGkAbgBlACwAIABgACMA YABg
  echo ACAAYwBvAG0AbQBlAG4AdABzACAAcwB1AHAAcABvAHIAdABlAGQAKQAKAC0A IABgAG0AYQBuAGkA
  echo ZgBlAHMAdABzAC8AdgBzAGMAbwBkAGUALQBlAHgAdABlAG4AcwBpAG8AbgBzAC4AdAB4AHQAIABg
  echo IOKAlAAgAFYAUwAgAEMAbwBkAGUAIABlAHgAdABlAG4AcwBpAG8AbgAgAEkARABzACAAKABvAG4A
  echo ZQAgAHAAZQByACAAbABpAG4AZQAsIGAAIwBgACAAYwBvAG0AbQBlAG4AdABzACAAcwB1AHAAcABv
  echo AHIAdABlAGQAKQAKAC0A IABgAHMAYwByAGkAcAB0AHMALwBgIOKAlAAgAGkAbgBzAHQAYQBsAGwA
  echo LwB1AHAAZABhAHQAZQAvAGMAbABlAGEAbgB1AHAAIABoAGUAbABwAGUAcgBzAAoALQAgAGAAZABv
  echo AGMAcwAvAGAAIOKAlAAgAGQAbwBjAHUAbQBlAG4AdABhAHQAaQBvAG4ACgAKACMAIwAgAE4AbwB0
  echo AGUAcwAKAAoALQAgAFMAbwBtAGUAIABIAG8AbQBlAGIAcgBlAHcAIABmAG8AcgBtAHUAbABhAGUA
  echo ZQAgAG0AYQB5ACAAZABlAGMAbABhAHIAZQAgAGAA b wBwAGUAbgBqAGQAawBgACAAYQBzACAAYQAg
  echo ZABlAHAAZQBuAGQAZQBuAGMAeQAgACgAZQAuAGcALgAgAE0AYQB2AGUAbgAvAEsAbwB0AGwAaQBuACkALgAg
  echo AAoAIAAgACoAKgBZAG8AdQByACAAcAByAGkAbQBhAHIAeQAgAEoARABLACAAaQBzACAAcwB0AGkAbABsACAAVABlAG0AdQByAGkAbgAqACoAIABhAG4AZAAgAGkAcwAgAG0AYQBuAGEAZwBlAGQAIAB2AGkAYQAgAGAAagBlAG4AdgBgAC4AIABVAHMAZQAgAHAAcgBvAGoAZQBjAHQAIAB3AHIAYQBwAHAAZQByAHMAIABgAC4ALwBtAHYAbgB3AGAA LwBgAC4ALwBnAHIAYQBkAGwAZQB3AGAAIAB3AGgAZQByAGUAIABwAG8AcwBzAGkAYgBsAGUALgAKAC0AIAAgAFYAUwAgAEMAbwBkAGUAIABlAHgAdABlAG4AcwBpAG8AbgAgAGkAbgBzAHQAYQBsAGwAYQB0AGkAbwBuACAAcgBlAHEAdQBpAHIAZQBzACAAdABoAGUAIABgAGMAbwBkAGUAZAAgAEMATABJACAAaQBuACAAUABBAFQAaAAgACgAVgBTACAAQwBvAGQAZQAg4oCTACAAQwBvAG0AbQBhAG4AZAAgAFAAYQBsAGUAdAB0AGUAIOKAlAAg4oCcAFMAaABlAGwAbAAgAEMAbwBtAG0AYQBuAGQAOgAgAEkAbgBzAHQAYQBsAGwAIAAnAGMAbwBkAGUAIABjAG8AbQBtAGEAbgBkACAAaQBuACAAUABBAFQAaAAn4oCdACkALgAKACIAJwBA
  echo ACQAZgBpAGwAZQBzAFsAJwBkAG8AYwBzAC8AVQBTAEEARwBFAC4AbQBkACcAXQAgAD0AIABAACcACgAjACAAVQBzAGEAZwBlAAoACgBUAGgAaQBzACAAcgBlAHAAbwBzAGkAdABvAHIAeQAgAGkAcwAgAGQAZQBzAGkAZwBuAGUAZAAgAHQAbwAgAGIAZQAgACoAKgBjAG8AcABpAGUAZAAgAHQAbwAgAGEAIABmAHIAZQBzAGgAbAB5ACAAaQBuAHMAdABhAGwAbABlAGQAIABNAGEAYwAqACoAIABhAG4AZAAgAHIAdQBuACAAZgByAG8AbQAgAFQAZQByAG0AaQBuAGEAbAAuAAoACgAjACMAIABXAGgAYQB0ACAAZwBlAHQAcwAgAGkAbgBzAHQAYQBsAGwAZQBkAAoACgAtACAAKgAqAEUAdgBlAHIAeQBkAGEAeQAgAHMAZQB0AHUAcAAqACoAIABgACgAcwBjAHIAaQBwAHQAcwAvAGkAbgBzAHQAYQBsAGwALgBzAGgAKQBgAAoAIAAgAC0AIABCAGEAcwBlACAAdQB0AGkAbABpAHQAaQBlAHMAIAAoAEMATABJACAAdABvAG8AbABzACwAIAB0AGUAcgBtAGkAbgBhAGwAIAB1AHQAaQBsAGkAdABpAGUAcwApAAoAIAAgAC0AIABPAGYAZgBpAGMAZQAvAFAARABEAC8ARQBtAGEAaQBsAC8AUwB5AG4AYwAgAHUAdABpAGwAaQB0AGkAZQBzAAoAIAAgAC0AIABCAHIAbwB3AHMAZQByAHMAIAArACAAbQBlAGQAaQBhAC8AcABoAG8AdABvAC8AdgBpAGQAZQBvACAAdABvAG8AbABzAAoACgAtACAAKgAqAEQAZQB2AGUAbABvAHAAZQByACAAcwBlAHQAdQBwACoAKgAgAGAAKABzAGMAcgBpAHAAdABzAC8AaQBuAHMAdABhAGwAbAAtAGQAZQB2AC4AcwBoACkAYAAKACAAIAAtACAASgBhAHYAYQAgACgAVABlAG0AdQByAGkAbgAgADIAMQAgACsAIABqAGUAbgB2ACAAKwAgAGIAdQBpAGwAZAAgAHQAbwBvAGwAcwApAAoAIAAgAC0AIABBAG4AZAByAG8AaQBkACAAdABvAG8AbABpAG4AZwAgACgAUwB0AHUAZABpAG8ALAAgAFMASwBEACAAdABvAG8AbABzACwAIABhAGQAYgAsACAATgBEAEsALAAgAGUAdABjAC4AKQAKACAAIAAtACAARgBsAHUAdAB0AGUAcgAgACsAIABDAG8AcgBkAG8AdgBhACAAcAByAGUAcgBlAHEAdQBpAHMAaQB0AGUAcwAgACgATgBvAGQAZQAuAGoAcwAgACsAIABuAHAAbQAgAHQAbwBvAGwAaQBuAGcAKQAKACAAIAAtACAAQwBvAG4AdABhAGkAbgBlAHIAcwAgACgARABvAGMAawBlAHIAIABDAEwASQAgACsAIABjAG8AbQBwAG8AcwBlAC8AYgB1AGkAbABkAHgACAAKwAgAEMAbwBsAGkAbQBhACAAKwAgAGwAaQBuAHQAZQByAHMALwBzAGMAYQBuAG4AZQByAHMAKQAKACAAIAAtACAASQBvAFQAIAAoAEEAcgBkAHUAaQBuAG8ALwBFAFMAUAAzADIAIAB0AG8AbwBsAGkAbgBnACkAKACAAIAAtACAAQwBsAG8AdQBkAGYAbABhAHIAZQAgAHQAbwBvAGwAaQBuAGcACgAgACAALQAgAEEAegB1AHIAZQAgACsAIABBAEsAUwAgAHQAbwBvAGwAaQBuAGcACgAKACMAIwAgAEkAbgBzAHQAYQBsAGwAIAAoAGUAdgBlAHIAeQBkAGEAeQApAAoACgBgAGAAIABiAGEAcwBoAAoAYgBhAHMAaAAgAHMAYwByAGkAcAB0AHMALwBpAG4AcwB0AGEAbABsAC4AcwBoACgAYABgAGAAIAoACgAjACMAIABJAG4AcwB0AGEAbABsACAAKABkAGUAdgBlAGwAbwBwAGUAcgApAAoACgBgAGAAIABiAGEAcwBoAAoAYgBhAHMAaAAgAHMAYwByAGkAcAB0AHMALwBpAG4AcwB0AGEAbABsAC0AZABlAHYALgBzAGgACgBgAGAAYAoACgAjACMAIABJAG4AcwB0AGEAbABsACAAKABhAGwAbAApAAoACgBgAGAAIABiAGEAcwBoAAoAYgBhAHMAaAAgAHMAYwByAGkAcAB0AHMALwBpAG4AcwB0AGEAbABsAC0AYQBsAGwALgBzAGgACgBgAGAAYAoACgAjACMAIABVAHAAZABhAHQAZQAgACgAYQBsAGwAKQAKAAoAYABgAGIAYQBzAGgACgBiAGEAcwBoACAAcwBjAHIAaQBwAHQAcwAvAHUAcABkAGEAdABlAC4AcwBoACgAYABgAGAAIAoACgAjACMAIABDAGwAZQBhAG4AdQBwAAoACgBgAGAAIABiAGEAcwBoAAoAYgBhAHMAaAAgAHMAYwByAGkAcAB0AHMALwBjAGwAZQBhAG4AdQBwAC4AcwBoACgAYABgAGAAIAoACgAjACMAIABCAHIAZQB3ACAAZABpAGEAZwBuAG8AcwB0AGkAYwBzAAoACgBgAGAAIABiAGEAcwBoAAoAYgBhAHMAaAAgAHMAYwByAGkAcAB0AHMALwBmAGkAeAAtAGIAcgBlAHcALgBzAGgACgBgAGAAYAoACgAjACMAIABIAG8AdwAgAHQAaABlACAAbQBhAG4AaQBmAGUAcwB0AHMAIAB3AG8AcgBrAAoACgAjACMAIyBCAHIAZQB3AGYAaQBsAGUAcwAKAAoARQBhAGMAaAAgAHQAbwBwAGkAYwAgAGgAYQBzACAAaQB0AHMAIABvAHcAbgAgAEIAcgBlAHcAZgBpAGwAZQAgAGkAbgAgAGAAQgByAGUAdwBmAGkAbABlAHMALwBgAC4AIABFAHgAYQBtAHAAbABlADoACgAKAGAAYABiAGEAcwBoAAoAYgByAGUAdwAgAGIAdQBuAGQAbABlACAALQAtAGYAaQBsAGUAIABCAHIAZQB3AGYAaQBsAGUAcwAvAEIAcgBlAHcAZgBpAGwAZQAuAG8AZgBmAGkAYwBlACgAYABgAGAAIAoACgAjACMAIyBuAHAAbQAgAGcAbABvAGIAYQBsACAAdABvAG8AbABzAAoACgBgAG0AYQBuAGkAZgBlAHMAdABzAC8AbgBwAG0ALQBnAGwAbwBiAGEAbAAuAHQAeAB0AGAAIABjAG8AbgB0AGEAaQBuAHMAIABvAG4AZQAgAG4AcABtACAAcABhAGMAawBhAGcAZQAgAG4AYQBtAGUAIABwAGUAcgAgAGwAaQBuAGUAIAAoAGMAbwBtAG0AZQBuAHQAcwAgAHcAaQB0AGgAIABgACMA YABhAGwAbABvAHcAZQBkACkALgAKAFQAaABlACAAcwBjAHIAaQBwAHQAcwAgAHcAaQBsAGwAIABpAG4AcwB0AGEAbABsAC8AdQBwAGQAYQB0AGUAIABvAG4AbAB5ACAAdABoAGUAIABwAGEAYwBrAGEAZwBlAHMAIABsAGkAcwB0AGUAZAAgAHQAaABlAHIAZQAuAAoACgAjACMAIyBWAFMAIABDAG8AZABlACAAZQB4AHQAZQBuAHMAaQBvAG4AcwAKAAoAYABtAGEAbgBpAGYAZQBzAHQAcwAvAHYAcwBjAG8AZABlAC0AZQB4AHQAZQBuAHMAaQBvAG4AcwAuAHQAeAB0AGAAIABjAG8AbgB0AGEAaQBuAHMAIABvAG4AZQAgAGUAeAB0AGUAbgBzAGkAbwBuACAASQBEACAAcABlAHIAIABsAGkAbgBlACAAKABjAG8AbQBlAG4AdABzACAAcwB1AHAAcABvAHIAdABlAGQAKQAuAAoAVABoAGUAIABzAGMAcgBpAHAAdABzACAAcwB0AGkAbABsACAAaQBuAHMAdABhAGwAbAAvAHUAcABkAGEAdABlACAAdABoAGUAcwBlACAAZQB4AHQAZQBuAHMAaQBvAG4AcwAgAHUAcwBpAG4AZwAgAHQAaABlACAA YABjAG8AZABlAGAAIABDAEwASQAgACgAaQBmACAAYQB2AGEAaQBsAGEAYgBsAGUAKQAuAAoACgAjACMAIABDAHUAcwB0AG8AbQBpAHoAYQB0AGkAbwBuAAoACgAtACAAQQBkAGQALwByAGUAbQBvAHYAZQAgAHQAbwBvAGwAcwAgAGIAeQAgAGUAZABpAHQAaQBuAGcAIABCAGUAdwBmAGkAbABlAHMAIABhAG4AZAAgAG0AYQBuAGkAZgBlAHMAdABzAC4ACgAtACAASwBlAGUAcAAgAGMAdABoAGEAbgBnAGUAcwAgAHQAbwBwAGkAYwAtAGIAYQBzAGUAZAAgAHQAbwAgAGEAdgBvAGkAZAAgAGIAbABvAGEAdABlAGQAIABtAG8AbgBvAGwAaQB0AGgAaQBjACAAbQBhAG4AaQBmAGUAcwB0AHMALgAKACIAJwBA
  echo ACQAZgBpAGwAZQBzAFsAJwBkAG8AYwBzAC8ATQBPAEQAVQBMAEUAUwAuAG0AZAAnAF0AIAA9ACAAQAAiACcACgAjACAATQBvAGQAdQBsAGUAcwAgACgAQgByAGUAdwBmAGkAbABlAHMAKQAKAAoAVABoAGkAcwAgAHIAZQBwAG8AIABpAHMAIABpAG4AdABlAG4AdABpAG8AbgBhAGwAbAB5ACAAcwBwAGwAaQB0ACAAaQBuAHQAbwAgAHQAbwBwAGkAYwAtAGIAYQBzAGUAZAAgAEIAcgBlAHcAZgBpAGwAZQBzAC4ACgAKACMAIwAgAEUAdgBlAHIAeQBkAGEAeQAgAG0AbwBkAHUAbABlAHMACgAKAC0AIABgAEIAcgBlAHcAZgBpAGwAZQAuAGIAYQBzAGUAYAAg4oCTACAAQwBMAEkAIABiAGEAcwBpAGMAcwAgACsAIABhACAAZgBlAHcAIABsAGkAZwBoAHQAdwBlAGkAZwBoAHQAIABtAGEAYwBPAFMAIAB1AHQAaQBsAGkAdABpAGUAcwAKAC0AIABgAEIAcgBlAHcAZgBpAGwAZQAuAG8AZgBmAGkAYwBlAGAAIOKAlAAgAG8AZgBmAGkAYwBlAC8AUABEAEYALwBlAG0AYQBpAGwALwBzAHkAbgBjAC8AZgBpAGwAZQAgAHQAcgBhAG4AcwBmAGUAcgAgAHUAdABpAGwAaQB0AGkAZQBzAAoALQAgAGAAQgByAGUAdwBmAGkAbABlAC4AYgByAG8AdwBzAGUAcgAtAG0AZQBkAGkAYQBgIOKAlAAgAGIAcgBvAHcAcwBlAHIAcwAgACsAIABtAHUAbAB0AGkAbQBlAGQAaQBhAC8AaQBtAGEAZwBlAC8AdgBpAGQAZQBvACAAdABvAG8AbABpAG4AZwAKAAoAIwAjACAARABlAHYAZQBsAG8AcABlAHIAIABtAG8AZAB1AGwAZQBzAAoACgAtACAA YABCAHI AZQB3AGYAaQBsAGUALgBkAGUAdgAtAGoAYQB2AGEAYAAg4oCTACAA VABlAG0AdQByAGkAbgAgADIAMQAgACsAIABqAGUAbgB2ACAAKwAgAEcAcgBhAGQAbABlAC8ATQBhAHYAZQBuACAAKwAgAEsAbwB0AGwAaQBuACAAKwAgAGYAbwByAG0AYQB0AHQAZQByAHMACgAtACAA YABCAHI AZQB3AGYAaQBsAGUALgBkAGUAdgAtAGEAbgBkAHIAbwBpAGQAYAAg4oCTACAAQQBuAGQAcgBvAGkAZAAgAFMAdAB1AGQAaQBvACAAKwAgAFMASwBEACAAdABvAG8AbABzACAAKwAgAGEAZABiACAAKwAgAE4ARABEASwAIAB+ACAAGg==
)

REM --- Robust PowerShell runner (no CMD line-continuation carets) ---
set "RUNNER=%TEMP%\mac-bootstrap-runner.ps1"

REM --- Robust PowerShell runner (no param() / no tricky syntax) ---
set "RUNNER=%TEMP%\mac-bootstrap-runner.ps1"

if exist "%RUNNER%" del /f /q "%RUNNER%" >nul 2>&1

> "%RUNNER%" (
  echo $ErrorActionPreference = 'Stop'
  echo if ^($args.Count -lt 2^) { throw 'Usage: runner.ps1 ^<b64file^> ^<outdir^>' }
  echo $B64Path = $args[0]
  echo $OutRepoPath = $args[1]
  echo if ^(-not ^(Test-Path -LiteralPath $B64Path^)^) { throw "Base64 file not found: $B64Path" }
  echo $b64 = Get-Content -Raw -LiteralPath $B64Path
  echo $bytes = [Convert]::FromBase64String($b64)
  echo $script = [Text.Encoding]::Unicode.GetString($bytes)
  echo Push-Location $OutRepoPath
  echo try { Invoke-Expression $script } finally { Pop-Location }
)

powershell.exe -NoProfile -ExecutionPolicy Bypass -File "%RUNNER%" "%B64FILE%" "%CD%"
set "ERR=%errorlevel%"

del /f /q "%RUNNER%" >nul 2>&1
REM ---------------------------------------------------------------


set ERR=%errorlevel%
del /f /q "%B64FILE%" >nul 2>&1
del /f /q "%PS1FILE%" >nul 2>&1

if %ERR% neq 0 (
  echo.
  echo ERROR: Generation failed. See messages above.
  exit /b %ERR%
)

echo.
echo Done. Repository created at:
echo   %CD%\mac-bootstrap
echo.
echo Next steps on macOS:
echo   cd mac-bootstrap
echo   bash scripts/prepare.sh
